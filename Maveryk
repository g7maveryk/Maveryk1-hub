local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

local Remotes = ReplicatedStorage.Remotes
local Functions = Remotes.Functions
local Events = Remotes.Events

local CombatRemote = Functions.CombatRF
local CollectionRemote = Functions.CollectionRF
local HatchRemote = Events.HatchEggEvent
local PlantRemote = Events.PlantEggEvent
local FeedRemote = Events.FeedEggEvent
local SacrificeRemote = Functions.SacrificeFunction
local UpgradeMonsterFunction = Functions.UpgradeMonsterFunction

local active = false
local loopFlags = {}
local eggsSelected = {}
local bossEnabled = {}
local zoneCache = {}
local activeBosses = {}
local lastBossScan = 0
local jumpConnection = nil
local jumpCount = 0

-- Lookup tables para acesso rápido
local eggLookup = {}
local bossZoneMap = {
    Naga = "Zone2B1",
    ["Lava Monster"] = "Zone5B1",
    ["Tiki Monster"] = "Zone10B1",
    ["The Frozen Ancient"] = "Zone12B1",
    ["The Big 100M"] = "Zone12B3",
    ["The Ethereal Everia"] = "Zone12B2",
    ["Hornet Boss"] = "SummerEventZoneB1",
    ["The Ice Serpent"] = "WinterEventZoneB1",
    ["Great Sphinx"] = "ElementEventZoneB1",
}

local config = {
    farmAllEnemies = false,
    farmEnemiesSpeed = 0.05,
    farmSummer = false,
    farmWinter = false,
    farmFood = false,
    foodSpeed = 0.03,
    farmBosses = false,
    bossAttackSpeed = 0.03,
    autoPlant = false,
    plantSpeed = 0.001,
    autoHatch = false,
    hatchSpeed = 0.001,
    autoNests = false,
    nestsSpeed = 0.001,
    sacrificeLoopQueen = false,
    sacrificeLoopKing = false,
    sacrificeLoopFrozen = false,
    sacrificeLoopWalrus = false,
    doubleJump = false,
    wallspeed = 16,
}

local bossList = {
    "Naga", "Lava Monster", "Tiki Monster",
    "The Frozen Ancient", "The Big 100M", "The Ethereal Everia",
    "Hornet Boss", "The Ice Serpent", "Great Sphinx"
}
for _, name in ipairs(bossList) do bossEnabled[name] = true end

local eggData = {
    { name = "Summer Egg", zone = "SummerEvent1" },
    { name = "Winter Egg", zone = "WinterEvent1" },
    { name = "Sphinx Egg", zone = "EleEgg1" },
    { name = "Desert Egg", zone = "6" },
    { name = "Swamp Egg", zone = "4" },
    { name = "Sky Egg", zone = "15" },
    { name = "Cosmos Egg", zone = "10" },
    { name = "Void Egg", zone = "27" },
    { name = "Tiki Egg", zone = "30" },
    { name = "Tiki Island Egg", zone = "11" },
    { name = "Draco Egg", zone = "34" },
    { name = "Crystal Egg", zone = "12.1" },
    { name = "Octopus Egg", zone = "30" },
    { name = "Forest Egg", zone = "1" },
    { name = "Frozen Egg", zone = "3" },
    { name = "Magma Egg", zone = "7" },
    { name = "Atlantis Egg", zone = "8" },
    { name = "Aqua Egg", zone = "9" },
    { name = "Egg Of Oblivion", zone = "12" },
    { name = "Mythical Egg", zone = "13" },
    { name = "Legendary Egg", zone = "14" },
    { name = "Naga Boss Egg", zone = "Boss1" },
    { name = "Lava Monster Boss Egg", zone = "Boss2" },
    { name = "Tiki Boss Egg", zone = "Boss4" },
}

-- Criar lookup table para eggs
for _, egg in ipairs(eggData) do
    eggLookup[egg.name] = egg.zone
end

-- Cache permanente de zonas
local function getZone(name)
    if not zoneCache[name] then
        zoneCache[name] = Workspace.Zones:FindFirstChild(name)
    end
    return zoneCache[name]
end

-- Cache de pets com update a cada 0.5s
local petCache = {}
local lastPetUpdate = 0
local function getPets()
    local now = tick()
    if now - lastPetUpdate > 0.5 then
        if LocalPlayer.Character then
            local pets = LocalPlayer.Character:FindFirstChild("Pets")
            petCache = pets and pets:GetChildren() or {}
        else
            petCache = {}
        end
        lastPetUpdate = now
    end
    return petCache
end

local function getPlayerPets()
    local data = LocalPlayer:FindFirstChild("PlayerData_Client")
    if data and data:FindFirstChild("Monsters") then
        return data.Monsters:GetChildren()
    end
    return {}
end

local function enemyLoop()
    while loopFlags.enemies and active do
        local pets = getPets()
        if #pets > 0 then
            local idx = 1
            if config.farmAllEnemies then
                for _, zone in ipairs({"SummerEventZone", "WinterEventZone"}) do
                    local z = getZone(zone)
                    if z and z:FindFirstChild("Enemies") then
                        for _, e in ipairs(z.Enemies:GetChildren()) do
                            if not active then break end
                            pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", e, pets[idx])
                            idx = idx % #pets + 1
                            task.wait(0.01)
                        end
                    end
                end
            else
                if config.farmSummer then
                    local z = getZone("SummerEventZone")
                    if z and z:FindFirstChild("Enemies") then
                        for _, e in ipairs(z.Enemies:GetChildren()) do
                            if not active then break end
                            pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", e, pets[idx])
                            idx = idx % #pets + 1
                            task.wait(0.01)
                        end
                    end
                end
                if config.farmWinter then
                    local z = getZone("WinterEventZone")
                    if z and z:FindFirstChild("Enemies") then
                        for _, e in ipairs(z.Enemies:GetChildren()) do
                            if not active then break end
                            pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", e, pets[idx])
                            idx = idx % #pets + 1
                            task.wait(0.01)
                        end
                    end
                end
            end
        end
        task.wait(config.farmEnemiesSpeed)
    end
end

local function foodLoop()
    while loopFlags.food and active and config.farmFood do
        local pets = getPets()
        if #pets > 0 then
            local zone = getZone("Zone12.1")
            if zone and zone:FindFirstChild("FoodSpawns") then
                local foods = zone.FoodSpawns:GetChildren()
                if #foods > 0 then
                    local idx = 1
                    for _, f in ipairs(foods) do
                        if not active then break end
                        pcall(CollectionRemote.InvokeServer, CollectionRemote, "CollectFood", f, pets[idx])
                        idx = idx % #pets + 1
                        task.wait(0.01)
                    end
                end
            end
        end
        task.wait(config.foodSpeed)
    end
end

local function scanBosses()
    if not active or not config.farmBosses then return end
    local newActive = {}
    
    for _, name in ipairs(bossList) do
        if bossEnabled[name] then
            local zone = getZone(bossZoneMap[name])
            local enemy = zone and zone:FindFirstChild("Enemies") and zone.Enemies:FindFirstChild(name)
            if enemy then
                table.insert(newActive, enemy)
            end
        end
    end
    activeBosses = newActive
end

local function bossLoop()
    while loopFlags.boss and active and config.farmBosses do
        local pets = getPets()
        if #pets > 0 and #activeBosses > 0 then
            local idx = 1
            for _, boss in ipairs(activeBosses) do
                if not active or not loopFlags.boss then break end
                if boss and boss.Parent then
                    pcall(CombatRemote.InvokeServer, CombatRemote, "AttackEnemy", boss, pets[idx])
                    idx = idx % #pets + 1
                    task.wait(config.bossAttackSpeed)
                end
            end
        end
        task.wait(0.1)
    end
end

-- Thread de scan a cada 15 segundos (só cria se necessário)
if config.farmBosses then
    task.spawn(function()
        while true do
            if active and config.farmBosses then
                scanBosses()
            end
            task.wait(15)
        end
    end)
end

local function plantLoop()
    while loopFlags.plant and active and config.autoPlant do
        if #eggsSelected > 0 then
            for _, zone in ipairs(eggsSelected) do
                for _ = 1, 9 do
                    if not active then break end
                    pcall(PlantRemote.FireServer, PlantRemote, zone)
                end
                task.wait(0.001)
            end
        end
        task.wait(config.plantSpeed)
    end
end

local function hatchLoop()
    while loopFlags.hatch and active and config.autoHatch do
        pcall(HatchRemote.FireServer, HatchRemote)
        task.wait(config.hatchSpeed)
    end
end

local function nestsLoop()
    while loopFlags.nests and active and config.autoNests do
        local nests = Workspace:FindFirstChild("Nests")
        if nests then
            for _, n in ipairs(nests:GetChildren()) do
                if not active then break end
                pcall(FeedRemote.FireServer, FeedRemote, n)
                task.wait(0.01)
            end
        end
        task.wait(config.nestsSpeed)
    end
end

local function sacrificeLoop()
    while loopFlags.sacrifice and active do
        if config.sacrificeLoopQueen then
            pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "Queen Bee")
        end
        if config.sacrificeLoopKing then
            pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "King Bee")
        end
        if config.sacrificeLoopFrozen then
            pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "Frozen Werewolf")
        end
        if config.sacrificeLoopWalrus then
            pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "Walrus")
        end
        task.wait(1)
    end
end

local function startAllLoops()
    loopFlags = { enemies = true, food = true, boss = true, plant = true, hatch = true, nests = true, sacrifice = true }
    if config.farmAllEnemies or config.farmSummer or config.farmWinter then task.spawn(enemyLoop) end
    if config.farmFood then task.spawn(foodLoop) end
    if config.farmBosses then 
        task.spawn(bossLoop)
        scanBosses()
    end
    if config.autoPlant then task.spawn(plantLoop) end
    if config.autoHatch then task.spawn(hatchLoop) end
    if config.autoNests then task.spawn(nestsLoop) end
    task.spawn(sacrificeLoop)
end

local function stopAllLoops()
    loopFlags = {}
    activeBosses = {}
end

local function start()
    if active then return end
    active = true
    startAllLoops()
end

local function stop()
    active = false
    stopAllLoops()
end

local win = Rayfield:CreateWindow({
    Name = "Maveryk Hub - Pet Swarm Simulator",
    LoadingTitle = "Loading...",
    LoadingSubtitle = "the best script for Pet Swarm Simulator",
    ConfigurationSaving = { Enabled = true, FolderName = "MaverykHub", FileName = "Config" },
    Theme = "Dark"
})

local mainTab = win:CreateTab("Main")
mainTab:CreateSection("Credits")
mainTab:CreateLabel("developed by Maveryk1t")
mainTab:CreateLabel("youtube: Maveryk1t")
mainTab:CreateLabel("discord: knzd1")

mainTab:CreateSection("Control")
mainTab:CreateButton({ Name = "Start Farming", Callback = start })
mainTab:CreateButton({ Name = "Stop Farming", Callback = stop })

mainTab:CreateSection("Status")
local statusLabel = mainTab:CreateLabel("Status: Stopped")
local bossStatus = mainTab:CreateLabel("Bosses: OFF")
local enemyStatus = mainTab:CreateLabel("Event Enemies: OFF")
local foodStatus = mainTab:CreateLabel("Food: OFF")
local eggStatus = mainTab:CreateLabel("Eggs: OFF")
local nestStatus = mainTab:CreateLabel("Nests: OFF")
local sacrificeStatus = mainTab:CreateLabel("Sacrifice: OFF")
local miscStatus = mainTab:CreateLabel("Misc: OFF")

task.spawn(function()
    while true do
        task.wait(0.5)
        if active then
            statusLabel:Set("Status: Active")
            bossStatus:Set("Bosses: " .. (config.farmBosses and "ON" or "OFF"))
            local enemyOn = config.farmAllEnemies or config.farmSummer or config.farmWinter
            enemyStatus:Set("Event Enemies: " .. (enemyOn and "ON" or "OFF"))
            foodStatus:Set("Food: " .. (config.farmFood and "ON" or "OFF"))
            eggStatus:Set("Eggs: " .. ((config.autoPlant or config.autoHatch) and "ON" or "OFF"))
            nestStatus:Set("Nests: " .. (config.autoNests and "ON" or "OFF"))
            local sacOn = config.sacrificeLoopQueen or config.sacrificeLoopKing or config.sacrificeLoopFrozen or config.sacrificeLoopWalrus
            sacrificeStatus:Set("Sacrifice: " .. (sacOn and "ON" or "OFF"))
            local miscOn = config.doubleJump
            miscStatus:Set("Misc: " .. (miscOn and "ON" or "OFF"))
        else
            statusLabel:Set("Status: Stopped")
            bossStatus:Set("Bosses: OFF")
            enemyStatus:Set("Event Enemies: OFF")
            foodStatus:Set("Food: OFF")
            eggStatus:Set("Eggs: OFF")
            nestStatus:Set("Nests: OFF")
            sacrificeStatus:Set("Sacrifice: OFF")
            miscStatus:Set("Misc: OFF")
        end
    end
end)

local farmTab = win:CreateTab("Farming")
farmTab:CreateSection("Event Enemies")
farmTab:CreateToggle({
    Name = "Enable All (Summer + Winter)",
    CurrentValue = config.farmAllEnemies,
    Callback = function(v)
        config.farmAllEnemies = v
        if v then
            config.farmSummer = false
            config.farmWinter = false
        end
    end
})
farmTab:CreateToggle({ Name = "Summer Only", CurrentValue = config.farmSummer, Callback = function(v) config.farmSummer = v; if v then config.farmAllEnemies = false end end })
farmTab:CreateToggle({ Name = "Winter Only", CurrentValue = config.farmWinter, Callback = function(v) config.farmWinter = v; if v then config.farmAllEnemies = false end end })
farmTab:CreateSlider({ Name = "Speed (s)", Range = {0.001, 1}, Increment = 0.001, Suffix = "s", CurrentValue = config.farmEnemiesSpeed, Callback = function(v) config.farmEnemiesSpeed = v end })

farmTab:CreateSection("Food")
farmTab:CreateToggle({ Name = "Farm Food", CurrentValue = config.farmFood, Callback = function(v) config.farmFood = v end })
farmTab:CreateSlider({ Name = "Speed (s)", Range = {0.001, 1}, Increment = 0.001, Suffix = "s", CurrentValue = config.foodSpeed, Callback = function(v) config.foodSpeed = v end })

local bossTab = win:CreateTab("Bosses")
bossTab:CreateSection("Boss Control")
bossTab:CreateToggle({ Name = "Enable Boss Farming", CurrentValue = config.farmBosses, Callback = function(v) config.farmBosses = v end })
bossTab:CreateToggle({ Name = "Enable All Bosses", CurrentValue = true, Callback = function(v)
    for _, name in ipairs(bossList) do bossEnabled[name] = v end
end })
bossTab:CreateSlider({ Name = "Attack Speed (s)", Range = {0.01, 0.3}, Increment = 0.01, Suffix = "s", CurrentValue = config.bossAttackSpeed, Callback = function(v) config.bossAttackSpeed = v end })
bossTab:CreateLabel("Boss scan every 15 seconds")

bossTab:CreateSection("Boss List")
for _, name in ipairs(bossList) do
    bossTab:CreateToggle({
        Name = name,
        CurrentValue = bossEnabled[name],
        Callback = function(v) bossEnabled[name] = v end
    })
end

local eggTab = win:CreateTab("Eggs")
eggTab:CreateSection("Eggs Farm")
eggTab:CreateToggle({
    Name = "Enable Eggs Farm",
    CurrentValue = false,
    Callback = function(v)
        config.autoPlant = v
        config.autoHatch = v
        config.autoNests = v
    end
})

eggTab:CreateSection("Select Eggs")
for _, egg in ipairs(eggData) do
    eggTab:CreateToggle({
        Name = egg.name,
        CurrentValue = false,
        Callback = function(val)
            if val then
                if not table.find(eggsSelected, egg.zone) then
                    table.insert(eggsSelected, egg.zone)
                end
            else
                local idx = table.find(eggsSelected, egg.zone)
                if idx then table.remove(eggsSelected, idx) end
            end
        end
    })
end

eggTab:CreateSection("Auto Plant")
eggTab:CreateToggle({ Name = "Enable Auto Plant", CurrentValue = config.autoPlant, Callback = function(v) config.autoPlant = v end })
eggTab:CreateSlider({ Name = "Speed (s)", Range = {0.0001, 1}, Increment = 0.0001, Suffix = "s", CurrentValue = config.plantSpeed, Callback = function(v) config.plantSpeed = v end })

eggTab:CreateSection("Auto Hatch")
eggTab:CreateToggle({ Name = "Enable Auto Hatch", CurrentValue = config.autoHatch, Callback = function(v) config.autoHatch = v end })
eggTab:CreateSlider({ Name = "Speed (s)", Range = {0.0001, 1}, Increment = 0.0001, Suffix = "s", CurrentValue = config.hatchSpeed, Callback = function(v) config.hatchSpeed = v end })

eggTab:CreateButton({
    Name = "Remove Hatch Animation",
    Callback = function()
        local ev = ReplicatedStorage:FindFirstChild("Remotes") and ReplicatedStorage.Remotes:FindFirstChild("Events")
        if ev and ev:FindFirstChild("HatchAnimationEvent") then
            ev.HatchAnimationEvent:Destroy()
        end
    end
})

eggTab:CreateSection("Auto Nests")
eggTab:CreateToggle({ Name = "Enable Auto Nests", CurrentValue = config.autoNests, Callback = function(v) config.autoNests = v end })
eggTab:CreateSlider({ Name = "Speed (s)", Range = {0.0001, 1}, Increment = 0.0001, Suffix = "s", CurrentValue = config.nestsSpeed, Callback = function(v) config.nestsSpeed = v end })

local sacrificeTab = win:CreateTab("Sacrifices")
sacrificeTab:CreateSection("Mythical")
sacrificeTab:CreateToggle({ Name = "Queen Bee (Mythical) - Loop", CurrentValue = config.sacrificeLoopQueen, Callback = function(v) config.sacrificeLoopQueen = v end })
sacrificeTab:CreateButton({ Name = "Sacrifice Queen Bee (Once)", Callback = function() pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "Queen Bee") end })
sacrificeTab:CreateToggle({ Name = "Frozen Werewolf (Mythical) - Loop", CurrentValue = config.sacrificeLoopFrozen, Callback = function(v) config.sacrificeLoopFrozen = v end })
sacrificeTab:CreateButton({ Name = "Sacrifice Frozen Werewolf (Once)", Callback = function() pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "Frozen Werewolf") end })

sacrificeTab:CreateSection("Legendary")
sacrificeTab:CreateToggle({ Name = "King Bee (Legendary) - Loop", CurrentValue = config.sacrificeLoopKing, Callback = function(v) config.sacrificeLoopKing = v end })
sacrificeTab:CreateButton({ Name = "Sacrifice King Bee (Once)", Callback = function() pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "King Bee") end })
sacrificeTab:CreateToggle({ Name = "Walrus (Legendary) - Loop", CurrentValue = config.sacrificeLoopWalrus, Callback = function(v) config.sacrificeLoopWalrus = v end })
sacrificeTab:CreateButton({ Name = "Sacrifice Walrus (Once)", Callback = function() pcall(SacrificeRemote.InvokeServer, SacrificeRemote, "SacrificeWell", "Walrus") end })

local miscTab = win:CreateTab("Misc")
miscTab:CreateSection("Movement")

miscTab:CreateToggle({ Name = "Infinite Double Jump", CurrentValue = config.doubleJump, Callback = function(v)
    config.doubleJump = v
    if v then
        local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Jumping, true)
            jumpCount = 0
            if not jumpConnection then
                jumpConnection = humanoid.Jumping:Connect(function()
                    jumpCount = jumpCount + 1
                    if jumpCount >= 2 then
                        humanoid.Jump = true
                        jumpCount = 0
                    end
                end)
            end
        end
    elseif jumpConnection then
        jumpConnection:Disconnect()
        jumpConnection = nil
        jumpCount = 0
    end
end })

miscTab:CreateSlider({ Name = "Walk Speed", Range = {16, 100}, Increment = 1, Suffix = "", CurrentValue = config.wallspeed, Callback = function(v)
    config.wallspeed = v
    local humanoid = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if humanoid then
        humanoid.WalkSpeed = v
    end
end })

miscTab:CreateSection("Hotkey")
miscTab:CreateLabel("Press H to hide/show GUI")

local guiVisible = true
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.H then
        guiVisible = not guiVisible
        for _, v in pairs(win:GetChildren()) do
            if v:IsA("ScreenGui") then
                v.Enabled = guiVisible
            end
        end
    end
end)

